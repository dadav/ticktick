{% extends "base.html" %}

{% block title %}TickTick - Statistik{% endblock %}

{% block content %}
<div class="stats-section">
    <h2>Diese Woche</h2>
    <div class="stats-row">
        <span class="label">Gesamtstunden:</span>
        <span class="value" id="week-total">{{ stats.this_week.total_formatted }} / {{ stats.this_week.target_formatted }}</span>
    </div>
    <div class="progress-bar">
        {% set progress = (stats.this_week.total_seconds / stats.this_week.target_seconds * 100) if stats.this_week.target_seconds > 0 else 0 %}
        <div class="fill {% if progress >= 100 %}overtime{% elif progress < 80 %}behind{% endif %}" id="week-progress" style="width: {{ [progress, 100] | min }}%"></div>
    </div>
    <div class="stats-row">
        <span class="label">Arbeitstage:</span>
        <span class="value" id="week-days">{{ stats.this_week.days_worked }}</span>
    </div>
    <div class="stats-row">
        <span class="label">Durchschnitt pro Tag:</span>
        <span class="value" id="week-avg">{{ stats.this_week.avg_per_day_formatted }}</span>
    </div>
    <div class="stats-row {% if stats.this_week.overtime_seconds >= 0 %}positive{% else %}negative{% endif %}" id="week-overtime-row">
        <span class="label" id="week-overtime-label">{% if stats.this_week.overtime_seconds >= 0 %}Überstunden:{% else %}Fehlstunden:{% endif %}</span>
        <span class="value" id="week-overtime">{{ stats.this_week.overtime_formatted }}</span>
    </div>
    <div class="stats-row">
        <span class="label">Durchschnittliche Startzeit:</span>
        <span class="value" id="week-average-start">{{ stats.this_week.average_start_time or '--:--' }}</span>
    </div>
    <div class="stats-row">
        <span class="label">Durchschnittliche Endzeit:</span>
        <span class="value" id="week-average-end">{{ stats.this_week.average_end_time or '--:--' }}</span>
    </div>
</div>

<div class="stats-section">
    <h2>Dieser Monat</h2>
    <div class="stats-row">
        <span class="label">Gesamtstunden:</span>
        <span class="value" id="month-total">{{ stats.this_month.total_formatted }}</span>
    </div>
    <div class="stats-row">
        <span class="label">Arbeitstage:</span>
        <span class="value" id="month-days">{{ stats.this_month.days_worked }}</span>
    </div>
    <div class="stats-row">
        <span class="label">Durchschnitt pro Tag:</span>
        <span class="value" id="month-avg">{{ stats.this_month.avg_per_day_formatted }}</span>
    </div>
    <div class="stats-row {% if stats.this_month.overtime_seconds >= 0 %}positive{% else %}negative{% endif %}" id="month-overtime-row">
        <span class="label" id="month-overtime-label">{% if stats.this_month.overtime_seconds >= 0 %}Überstunden:{% else %}Fehlstunden:{% endif %}</span>
        <span class="value" id="month-overtime">{{ stats.this_month.overtime_formatted }}</span>
    </div>
    <div class="stats-row">
        <span class="label">Durchschnittliche Startzeit:</span>
        <span class="value" id="month-average-start">{{ stats.this_month.average_start_time or '--:--' }}</span>
    </div>
    <div class="stats-row">
        <span class="label">Durchschnittliche Endzeit:</span>
        <span class="value" id="month-average-end">{{ stats.this_month.average_end_time or '--:--' }}</span>
    </div>
</div>

<div class="stats-section">
    <h2>Letzte Eintr&auml;ge</h2>
    <div class="sessions-list">
        {% for session in stats.recent_sessions %}
        <div class="session-item" data-session-id="{{ session.id }}" onclick="showSessionDetails({{ session.id }})">
            <span class="date">{{ session.date }}</span>
            <span class="times">{{ session.start_time }} - {{ session.end_time or '--:--' }}</span>
            <span class="duration">{{ session.net_work_formatted }}</span>
            <span class="overtime {% if session.overtime_seconds >= 0 %}positive{% else %}negative{% endif %}">{{ session.overtime_formatted }}</span>
            <button class="btn-delete" onclick="event.stopPropagation(); deleteSession({{ session.id }})" title="Eintrag l&ouml;schen" aria-label="Eintrag l&ouml;schen">&#x2715;</button>
        </div>
        {% else %}
        <p style="color: #888; text-align: center; padding: 1rem;">Noch keine abgeschlossenen Eintr&auml;ge.</p>
        {% endfor %}
    </div>
</div>

<!-- Session Details Modal -->
<div id="session-modal" class="modal" onclick="closeModalOnBackdrop(event)">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Session Details</h3>
            <button class="modal-close" onclick="closeModal()" aria-label="Schliessen">&times;</button>
        </div>
        <div class="modal-body" id="modal-body">
            <!-- Content loaded dynamically -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/statistics.js?v={{ version }}" defer></script>
{% endblock %}
